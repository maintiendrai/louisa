---
layout: post
title: SVN迁移到Git的过程(svn2git)
categories:
- Tools
tags:
- SVN GIT
---

##SVN完美迁移到Git

###前言
SVN迁移到GIT，一般我们想到的是《Pro Git》上的git svn命令 它可以把SVN迁移到GIT，它可以支持双向提交，即提交到GIT的同时提交到SVN。但是这个可能是不完美的，因为SVN跟GIT毕竟不是一个东西，组织结构也不一样 github上面推荐svn2git工具。支持完美GIT，但是对SVN的双向commit有所欠缺

###Installation
Make sure you have git, git-svn, and ruby installed. svn2git is a ruby wrapper around git's native SVN support through git-svn. It is possible to have git installed without git-svn installed, so please do verify that you can run $ git svn successfully. For a Debian-based system, the installation of the prerequisites would look like:

	$ sudo apt-get install git-core git-svn ruby
	
Once you have the necessary software on your system, you can install svn2git through rubygems, which will add the svn2git command to your PATH.

	$ sudo gem install svn2git
	
###Usage
Initial Conversion
编辑author.txt（具体路径待修改）

	$ svn log --quiet svn://111.24.73.118/asterisk --username xxx --password xxx  | grep -E "r[0-9]+ \| .+ \|" | cut -d'|' -f2 | sed 's/ //g' | sort | uniq
	
	返回
	crm
	lfr
	ljp
	lwq
修改author.txt为（具体人不一样）

	user = user <email@domain.cn>
	xxx = xxx <xxx@domain.cn>                                          
修改
	修改svn2git的BUG

	$ vim /Applications/Xcode.app/Contents/Developer/usr/share/git-core/perl/Git/SVN.pm +106
修改

         my $u = (::cmt_metadata("$refname"))[0];                                 
         $u =~ s!^\Q$url\E(/|$)!! or die                                          
           "$refname: '$url' not found in '$u'\n";
为

          my $u = (::cmt_metadata("$refname"))[0];                                 
        if(!$u) {                                                                
            $u = $pathname;                                                      
        }else {                                                                  
            $u =~ s!^\Q$url\E(/|$)!! or die                                      
            "$refname: '$url' not found in '$u'\n";                              
        }  
迁移

	 $ svn2git https://192.168.60.200/svn/widisk/ --trunk trunk/widisk --branches branches --tags tags --authors authors.txt --verbose

到这步的时候，本地已经clone了SVN仓库，现在需要的就是提交到远程了。首先，关联github远程仓库，如下：

git remote add origin git@192.168.60.151:lilkr/widisk.git
git push -u origin master
现在所有的旧分支都变成真正的Git 分支，所有的旧标签也变成真正的Git 标签。最后，一项工作就是把新建的Git 服务器添加为远程服务器并且向它推送。为了让所有的分支和标签都得到上传，我们使用这条命令

git push --all origin
所有的分支和标签现在都应该整齐干净的躺在新的Git 服务器里了。

如果有其它问题，参见https://github.com/nirvdrum/svn2git